<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Noche Pixel – romántica v12 (compact)</title>
  <style>
    :root { --radius: 14px; }
    * { box-sizing: border-box }
    html, body { height: 100%; margin: 0; overflow: hidden; }
    body { background:#0b1120; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; }
    #scene { position:fixed; inset:0; width:100vw; height:100vh; display:block; }

    /* === Reproductor Spotify compacto === */
    .spotify{
      position:fixed;
      right:max(10px, env(safe-area-inset-right));
      bottom:max(10px, env(safe-area-inset-bottom));
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.55);
      background:#0f172a;
      z-index:10;
    }
    /* Tamaño reducido: portada + controles (sin lista) */
    .spotify iframe{
      display:block; border:0;
      width:clamp(180px, 40vw, 240px);
      height:152px;                 /* altura mínima para playlist compacta */
    }

    /* En móviles: centrar arriba para no tapar la pareja */
    @media (max-width:640px){
      .spotify{
        right:50%; transform:translateX(50%);
        top:max(10px, env(safe-area-inset-top));
        bottom:auto;
      }
      .spotify iframe{
        width:200px;  /* más estrecho en móvil */
        height:152px;
      }
    }
  </style>
</head>
<body>
  <canvas id="scene"></canvas>

  <!-- Usa tu playlist en modo oscuro y compacto -->
  <div class="spotify">
    <iframe
      src="https://open.spotify.com/embed/playlist/5I9ZvE52QlLdc8SdU1WCVP?theme=0"
      allow="encrypted-media"
      loading="lazy"
      title="Spotify – Mi amor en forma de boleros">
    </iframe>
  </div>

<script>
/* ================== ESCENA PIXEL ROMÁNTICA (igual que v11) ================== */
(function(){
  const canvas = document.getElementById('scene');
  const ctx = canvas.getContext('2d');
  if(!ctx){ alert("Tu navegador no soporta canvas 2D"); return; }

  var PX = 2;
  function recalcScale(){ PX = Math.max(2, Math.floor(Math.min(innerWidth, innerHeight)/360)); }

  let DPR = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
  function resize(){
    DPR = Math.max(1, Math.min(3, window.devicePixelRatio || 1));
    const w = innerWidth, h = innerHeight;
    canvas.width  = Math.floor(w*DPR);
    canvas.height = Math.floor(h*DPR);
    canvas.style.width  = w+'px';
    canvas.style.height = h+'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    ctx.imageSmoothingEnabled = false;
    recalcScale();
    buildCity();
    layoutFairyLights();
    layoutHearts(true);
    layoutFireflies();
  }
  addEventListener('resize', resize, {passive:true});

  const stars = Array.from({length:190},()=>({
    x:Math.random(), y:Math.random()*0.65, r:Math.random()*1.7+0.5,
    p:Math.random()*Math.PI*2, a:0.55+Math.random()*0.45
  }));

  const layers = [
    {color:'#182348', speed:0.16, b:[]},
    {color:'#213061', speed:0.30, b:[]},
    {color:'#2a3b7a', speed:0.52, b:[]}
  ];
  function buildCity(){
    const W=innerWidth,H=innerHeight, base=[16,12,9];
    layers.forEach((L,i)=>{
      L.b=[]; const n=Math.round(base[i]*(W/1200+0.5));
      for(let k=0;k<n;k++){
        const bw=Math.floor((32+Math.random()*90)*(PX/2));
        const bh=Math.floor((80+Math.random()*240)*(PX/2));
        const x=Math.floor(Math.random()*(W+200))-100;
        const y=H-bh-(48+i*16)*PX;
        L.b.push({x,y,w:bw,h:bh, seed:Math.random()});
      }
    });
  }

  const comet = {x:0,y:0,active:false,trail:[],speed:10};
  let windowFrame={x:0,y:0,w:0,h:0};

  /* Guirnalda */
  let bulbs = [];
  function layoutFairyLights(){
    const f = windowFrame;
    const gap = Math.max(14*PX, f.w/16);
    bulbs = [];
    for(let i=0, x=f.x+10*PX; x<f.x+f.w-10*PX; i++, x+=gap){
      const sway = Math.sin(i*0.9)*3*PX;
      const y = f.y + 8*PX + sway;
      bulbs.push({x, y, phase: Math.random()*Math.PI*2});
    }
  }
  function drawFairyLights(t){
    ctx.strokeStyle="#3a2a1a"; ctx.lineWidth = 1*PX;
    ctx.beginPath();
    bulbs.forEach((b,i)=>{
      const ny=b.y + Math.sin((t/700)+i*0.5)*0.6*PX;
      if(i===0) ctx.moveTo(b.x, ny); else ctx.lineTo(b.x, ny);
    });
    ctx.stroke();
    bulbs.forEach((b,i)=>{
      const ny=b.y + Math.sin((t/700)+i*0.5)*0.6*PX;
      const pulse = 0.7 + 0.3*Math.sin(t/600 + b.phase);
      const g = ctx.createRadialGradient(b.x, ny, 0, b.x, ny, 8*PX);
      g.addColorStop(0, `rgba(255,198,120,${0.4*pulse})`);
      g.addColorStop(1, 'rgba(255,198,120,0)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(b.x, ny, 8*PX, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = "#ffd7a0";
      const r=2*PX; ctx.fillRect(b.x-r, ny-r, 2*r, 2*r);
      ctx.strokeStyle="#000"; ctx.lineWidth=1; ctx.strokeRect(b.x-r, ny-r, 2*r, 2*r);
    });
  }

  /* Corazones */
  let hearts = [];
  function layoutHearts(reset=false){
    if(reset) hearts=[];
    while(hearts.length<18) hearts.push(spawnHeart());
  }
  function spawnHeart(){
    const cx = windowFrame.x + windowFrame.w/2;
    const cy = windowFrame.y + windowFrame.h - 18*PX;
    return {
      x: cx + (Math.random()*40-20)*PX,
      y: cy + (Math.random()*8-4)*PX,
      vy: 0.3 + Math.random()*0.6,
      drift: (Math.random()*0.6-0.3),
      s: (Math.random()<0.6?1:2),
      a: 0.5 + Math.random()*0.5,
      hue: Math.random()<0.5 ? '#ff7aa8' : '#ff9dbb'
    };
  }
  function drawPixelHeart(x,y,scale,color,alpha){
    const s = PX*scale;
    const heart = [
      "01100110",
      "11111111",
      "11111111",
      "01111110",
      "00111100",
      "00011000",
      "00000000"
    ];
    ctx.globalAlpha = alpha;
    ctx.fillStyle = color;
    for(let j=0;j<heart.length;j++)
      for(let i=0;i<heart[0].length;i++)
        if(heart[j][i]==="1") ctx.fillRect(Math.round(x+i*s), Math.round(y+j*s), s, s);
    ctx.globalAlpha = 1;
  }
  function updateHearts(){
    hearts.forEach(h=>{ h.y -= h.vy; h.x += Math.sin(h.y/10)*h.drift; h.a -= 0.0025; });
    for(let i=hearts.length-1;i>=0;i--){
      const h=hearts[i];
      if(h.a<=0 || h.y < windowFrame.y + 6*PX){ hearts.splice(i,1); hearts.push(spawnHeart()); }
    }
  }
  function drawHearts(){ hearts.forEach(h=> drawPixelHeart(h.x, h.y, h.s, h.hue, h.a)); }

  /* Luciérnagas */
  let fireflies = [];
  function layoutFireflies(){
    const count = 20;
    fireflies = Array.from({length:count},()=>({
      x: windowFrame.x + Math.random()*windowFrame.w,
      y: windowFrame.y + windowFrame.h + 8*PX + Math.random()*60*PX,
      p: Math.random()*Math.PI*2,
      r: Math.random()*1.5 + 1
    }));
  }
  function drawFireflies(t){
    fireflies.forEach((f,i)=>{
      const flick = 0.4 + 0.6*Math.sin(t/900 + f.p + i*0.37);
      const g = ctx.createRadialGradient(f.x, f.y, 0, f.x, f.y, 10*PX);
      g.addColorStop(0, `rgba(255,220,140,${0.7*flick})`);
      g.addColorStop(1, 'rgba(255,220,140,0)');
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(f.x, f.y, 10*PX, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle="#ffe7a8"; ctx.globalAlpha = 0.9*flick;
      ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
      ctx.globalAlpha = 1;
    });
  }

  /* Sprites */
  const skin1='#f0bfa1', skin2='#d4a574', hairDark='#3d2817', hairBrown='#8b4513';
  const hoodie1='#1e72e6', hoodie1Dark='#1555ad', sweater2='#e74c3c', sweater2Dark='#c0392b';
  const jeans='#2c3e50', skirt='#f39c12', shoe='#2c2c2c';

  function createCouple(breathe=0){
    const W=40,H=34, G=Array.from({length:H},()=>Array(W).fill(null));
    const set=(x,y,w,h,c)=>{
      for(let j=0;j<h;j++){ const yy=y+j; if(yy<0||yy>=H) continue;
        for(let i=0;i<w;i++){ const xx=x+i; if(xx<0||xx>=W) continue; G[yy][xx]=c; }
      }
    };
    const b = Math.round(Math.sin(breathe)*1);
    set(4,31,32,1,'rgba(0,0,0,.28)');
    // chico
    set(7,6,4,4,skin1); set(8,5,2,1,skin1);
    set(6,4,6,3,hairDark); set(7,3,4,1,hairDark);
    set(5,10+b,10,11,hoodie1); set(5,14+b,10,1,hoodie1Dark); set(5,18+b,10,2,hoodie1Dark);
    set(3,12+b,2,6,hoodie1); set(13,12+b,2,4,hoodie1);
    set(7,21+b,6,6,jeans); set(7,23+b,6,1,'#34495e');
    set(6,27+b,3,2,shoe); set(11,27+b,3,2,shoe);
    // chica
    set(22,7,4,4,skin2); set(23,6,2,1,skin2);
    set(20,5,8,4,hairBrown); set(21,3,6,2,hairBrown);
    set(18,10+b,12,10,sweater2); set(18,14+b,12,1,sweater2Dark);
    set(16,13+b,3,4,sweater2); set(28,13+b,2,5,sweater2);
    set(20,20+b,10,6,skirt); set(20,22+b,10,1,'#e67e22');
    set(21,26+b,2,2,skin2); set(25,26+b,2,2,skin2);
    set(20,28+b,3,2,'#8e44ad'); set(25,28+b,3,2,'#8e44ad');
    // abrazo
    set(14,14+b,2,2,hoodie1); set(12,11+b,2,2,sweater2);
    return G;
  }

  function createDog(frame=0){
    const W=24,H=16, G=Array.from({length:H},()=>Array(W).fill(null));
    const set=(x,y,w,h,c)=>{
      for(let j=0;j<h;j++){ const yy=y+j; if(yy<0||yy>=H) continue;
        for(let i=0;i<w;i++){ const xx=x+i; if(xx<0||xx>=W) continue; G[yy][xx]=c; }
      }
    };
    const dogW='#fff', dogG='#e8e8e8';
    set(6,6,12,6,dogW); set(3,4,5,6,dogW); set(8,4,2,2,dogW);
    if(frame===0){ set(18,6,3,2,dogW); set(21,5,1,2,dogG);} else { set(18,7,3,2,dogW); set(21,8,1,2,dogG); }
    set(8,12,2,3,dogG); set(14,12,2,3,dogG);
    set(5,6,1,1,'#333'); set(4,8,1,1,'#333');
    return G;
  }

  function createDogSleeping(){
    const W=24,H=16, G=Array.from({length:H},()=>Array(W).fill(null));
    const set=(x,y,w,h,c)=>{
      for(let j=0;j<h;j++){ const yy=y+j; if(yy<0||yy>=H) continue;
        for(let i=0;i<w;i++){ const xx=x+i; if(xx<0||xx>=W) continue; G[yy][xx]=c; }
      }
    };
    const dogW='#fff', dogG='#e8e8e8';
    set(6,8,12,5,dogW); set(4,9,4,4,dogW);
    set(16,10,3,2,dogG);
    set(7,9,1,1,'#333');
    return G;
  }

  function drawPixelSprite(grid, ox, oy, scale = 1){
    const s = PX*scale;
    for(let y=0;y<grid.length;y++){
      for(let x=0;x<grid[0].length;x++){
        const c = grid[y][x]; if(!c) continue;
        ctx.fillStyle = c; ctx.fillRect(ox + x*s, oy + y*s, s, s);
      }
    }
  }

  /* Interacción */
  function triggerComet(){ const f=windowFrame; comet.active=true; comet.trail=[]; comet.x=f.x+f.w+60; comet.y=f.y+Math.random()*f.h*0.45+8*PX; }
  let lastInteract = performance.now();
  function onInteract(){ lastInteract = performance.now(); triggerComet(); burstHearts(); }
  canvas.addEventListener('click', onInteract);
  canvas.addEventListener('touchstart', (e)=>{ onInteract(); e.preventDefault(); }, {passive:false});

  function burstHearts(){
    for(let i=0;i<6;i++){
      const h = spawnHeart();
      h.vy = 0.9 + Math.random()*0.9; h.a  = 0.9; h.drift = (Math.random()*1.2-0.6);
      hearts.push(h);
    }
  }

  /* Sala y ventana */
  function drawRoom(){
    const W=innerWidth,H=innerHeight;
    const bg=ctx.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,"#0b1228"); bg.addColorStop(1,"#101428");
    ctx.fillStyle=bg; ctx.fillRect(0,0,W,H);

    const mx=Math.max(16*PX, W*0.06), my=Math.max(12*PX, H*0.06);
    const fw=Math.max(320, W - mx*2);
    const fh=Math.max(220, Math.min(H*0.64, H - my*2));
    const fx=(W - fw)/2, fy=my;

    ctx.fillStyle="#071022"; ctx.fillRect(fx,fy,fw,fh);
    ctx.lineWidth=10*PX; ctx.strokeStyle="#6a3c1f"; ctx.strokeRect(fx+5*PX,fy+5*PX,fw-10*PX,fh-10*PX);
    ctx.lineWidth=6*PX; ctx.strokeStyle="rgba(255,180,120,.08)"; ctx.strokeRect(fx+8*PX,fy+8*PX,fw-16*PX,fh-16*PX);
    ctx.fillStyle="#6a3c1f"; ctx.fillRect(fx+fw/2-2*PX, fy+2*PX, 4*PX, fh-4*PX);
    ctx.fillStyle="#151b2d"; ctx.fillRect(fx-8*PX, fy+fh, fw+16*PX, 6*PX);
    ctx.fillStyle="#0f1526"; ctx.fillRect(fx-8*PX, fy+fh+6*PX, fw+16*PX, 6*PX);
    ctx.fillStyle="#0c1222"; ctx.fillRect(0, fy+fh+12*PX, W, H-(fy+fh+12*PX));

    windowFrame={x:fx,y:fy,w:fw,h:fh};
  }

  /* Cielo, ciudad, cometa */
  function drawCityAndSky(t){
    const {x,y,w,h}=windowFrame;
    ctx.save(); ctx.beginPath(); ctx.rect(x,y,w,h); ctx.clip();

    const g=ctx.createLinearGradient(0,y,0,y+h);
    g.addColorStop(0,"#0b1c4a"); g.addColorStop(0.7,"#071033"); g.addColorStop(1,"#050a19");
    ctx.fillStyle=g; ctx.fillRect(x,y,w,h);

    const mx = x + w*0.78, my = y + h*0.22, moonR = 10*PX;
    const halo = ctx.createRadialGradient(mx,my,0, mx,my, moonR*5);
    halo.addColorStop(0,'rgba(240,240,255,0.35)'); halo.addColorStop(1,'rgba(240,240,255,0)');
    ctx.fillStyle=halo; ctx.beginPath(); ctx.arc(mx,my,moonR*5,0,Math.PI*2); ctx.fill();
    ctx.fillStyle="#f4f6ff"; ctx.beginPath(); ctx.arc(mx,my,moonR,0,Math.PI*2); ctx.fill();

    for(const s of stars){
      const tw=0.6+0.4*Math.sin(t/900+s.p);
      ctx.globalAlpha=s.a*tw; ctx.fillStyle="#fff";
      ctx.beginPath(); ctx.arc(x+s.x*w, y+s.y*h, s.r, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha=1;

    layers.forEach((L, idx)=>{
      for(const b of L.b){
        const shift=(t*L.speed)%(w+200);
        const bx=x+((b.x-shift+w+200)%(w+200))-100;
        const by=y+(b.y-(innerHeight-h));
        ctx.fillStyle=L.color; ctx.fillRect(bx,by,b.w,b.h);
        if(idx>0){
          const cols=Math.max(2, Math.floor(b.w/(6*PX)));
          const rows=Math.max(2, Math.floor(b.h/(10*PX)));
          ctx.fillStyle="rgba(255,220,140,.9)";
          for(let r=0;r<rows;r++)
            for(let c=0;c<cols;c++)
              if((r+c)%3===0 && Math.random()<0.1+idx*0.03)
                ctx.fillRect(bx+4*PX + c*6*PX, by+4*PX + r*10*PX, 2*PX, 2*PX);
        }
      }
    });

    function drawComet(cx,cy){
      const rad=4*PX;
      const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,rad*3);
      grad.addColorStop(0,"rgba(255,235,200,1)");
      grad.addColorStop(1,"rgba(255,235,200,0)");
      ctx.fillStyle=grad; ctx.beginPath(); ctx.arc(cx,cy,rad*3,0,Math.PI*2); ctx.fill();
      for(let i=0;i<14;i++){
        ctx.globalAlpha=Math.max(0,0.9-i*0.06);
        ctx.fillStyle="rgba(255,200,160,1)";
        ctx.fillRect(cx+i*6*PX, cy+(i%2?1:-1)*PX, 2*PX, 1*PX);
      }
      ctx.globalAlpha=1;
    }
    if(comet.active){
      comet.trail.push({x:comet.x,y:comet.y}); if(comet.trail.length>14) comet.trail.shift();
      for(let i=0;i<comet.trail.length;i++){ const p=comet.trail[i]; ctx.globalAlpha=i/comet.trail.length*0.7; drawComet(p.x,p.y); }
      ctx.globalAlpha=1; drawComet(comet.x,comet.y);
      comet.x -= comet.speed; comet.y += comet.speed*0.18;
      if(comet.x < x-100 || comet.y > y+h+60){ comet.active=false; comet.trail=[]; }
    } else if(Math.random()<0.0025){ triggerComet(); }

    const vign=ctx.createRadialGradient(x+w/2,y+h/2,Math.min(w,h)*0.25, x+w/2,y*h/2,Math.max(w,h)*0.85);
    vign.addColorStop(0,"rgba(0,0,0,0)"); vign.addColorStop(1,"rgba(0,0,0,0.22)");
    ctx.fillStyle=vign; ctx.fillRect(x,y,w,h);
    ctx.fillStyle="rgba(255,60,120,0.06)"; ctx.fillRect(x,y,w,h);

    ctx.restore();
  }

  /* Zzz del perrito dormido */
  let zs = [];
  function spawnZ(x,y){ zs.push({x,y,a:1,vy:0.3+Math.random()*0.2}); }
  function updateZs(){ zs.forEach(z=>{ z.y-=z.vy; z.a-=0.01; }); zs = zs.filter(z=> z.a>0); }
  function drawZs(){
    ctx.globalAlpha = 1;
    zs.forEach(z=>{
      ctx.globalAlpha = Math.max(0,z.a);
      ctx.fillStyle = "#d7d7ff";
      const s = PX;
      ctx.fillRect(z.x, z.y, 3*s, s);
      ctx.fillRect(z.x+2*s, z.y+s, s, s);
      ctx.fillRect(z.x, z.y+2*s, 3*s, s);
    });
    ctx.globalAlpha = 1;
  }

  /* Loop */
  let dogFrame=0, lastSwitch=performance.now();
  function loop(t){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawRoom();
    drawCityAndSky(t);
    drawFairyLights(t);

    const couple = createCouple((t/1000)%(2*Math.PI));
    const cw = 80*PX, ch = 64*PX;
    const cx = windowFrame.x + windowFrame.w/2 - cw/2;
    const cy = windowFrame.y + windowFrame.h - ch/2 + 10*PX;

    updateHearts(); drawHearts();

    const idleMs = t - lastInteract;
    const sleeping = idleMs > 8000;

    if (t - lastSwitch > 450){ dogFrame=(dogFrame+1)%2; lastSwitch=t; }
    const dog = sleeping ? createDogSleeping() : createDog(dogFrame);
    const dx = windowFrame.x + windowFrame.w/2 - 12*PX;
    const dy = cy + (sleeping ? 16*PX : 12*PX);
    drawPixelSprite(dog, dx, dy, 2);

    if (sleeping && Math.random()<0.08) spawnZ(dx + 28*PX, dy - 6*PX);
    updateZs(); drawZs();

    drawPixelSprite(couple, cx, cy, 2);

    drawFireflies(t);

    requestAnimationFrame(loop);
  }

  resize();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
